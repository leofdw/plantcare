{% extends "base.html" %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ä–∞—Å—Ç–µ–Ω–∏–π - PlantCare{% endblock %}

{% block body %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="plants-container">
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="plants-header">
            <div class="header-content">
                <div>
                    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ä–∞—Å—Ç–µ–Ω–∏–π</h1>
                    <p>–ò–∑—É—á–∞–π—Ç–µ –±–∞–∑—É —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</p>
                </div>
                <div class="filters">
                    <select class="filter-select" id="typeFilter">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="–∫–æ–º–Ω–∞—Ç–Ω–æ–µ">–ö–æ–º–Ω–∞—Ç–Ω—ã–µ</option>
                        <option value="—Å–∞–¥–æ–≤–æ–µ">–°–∞–¥–æ–≤—ã–µ</option>
                        <option value="–±–∞–ª–∫–æ–Ω–Ω–æ–µ">–ë–∞–ª–∫–æ–Ω–Ω—ã–µ</option>
                    </select>
                    
                    <select class="filter-select" id="careFilter">
                        <option value="">–õ—é–±–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å</option>
                        <option value="–õ—ë–≥–∫–∏–π">–õ—ë–≥–∫–∏–π</option>
                        <option value="–°—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="–°–ª–æ–∂–Ω—ã–π">–°–ª–æ–∂–Ω—ã–π</option>
                    </select>
                    
                    <select class="filter-select" id="lifespanFilter">
                        <option value="">–õ—é–±–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                        <option value="–æ–¥–Ω–æ–ª–µ—Ç–Ω–µ–µ">–û–¥–Ω–æ–ª–µ—Ç–Ω–∏–µ</option>
                        <option value="–¥–≤—É–ª–µ—Ç–Ω–µ–µ">–î–≤—É–ª–µ—Ç–Ω–∏–µ</option>
                        <option value="–º–Ω–æ–≥–æ–ª–µ—Ç–Ω–µ–µ">–ú–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–µ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ -->
        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="plantSearch" placeholder="–ü–æ–∏—Å–∫ —Ä–∞—Å—Ç–µ–Ω–∏–π...">
            </div>
        </div>

       <!-- –°–µ—Ç–∫–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π -->
        <div class="plants-grid" id="plantsGrid">
            {% for plant in plants %}
            <div class="plant-card" 
                data-name="{{ plant.name }}"
                data-latin="{{ plant.latin_name }}"
                data-image="{{ plant.image_url }}"
                data-care="{{ plant.difficulty }}" 
                data-light="{{ plant.light }}"
                data-water="{{ plant.water_frequency }}"
                data-description="{{ plant.description }}"
                data-additional-care="{{ plant.care_instructions }}"
                data-temperature="{{ plant.temperature }}"
                data-type="{{ plant.plant_type }}"
                data-lifespan="{{ plant.lifespan }}">
                <div class="plant-image" style="background-image: url('{{ plant.image_url }}');">
                    <button class="favorite-btn {% if plant.id in favorite_plant_ids %}active{% endif %}" 
                            data-plant-id="{{ plant.id }}">
                        ‚ô•
                    </button>
                    <div class="plant-care-level" data-difficulty="{{ plant.difficulty }}">
                        {{ plant.difficulty }}
                    </div>
                </div>
                <div class="plant-info">
                    <h3>{{ plant.name }}</h3>
                    <p class="plant-latin">{{ plant.latin_name }}</p>
                    
                    <!-- –¢–æ–ª—å–∫–æ —Ç–∏–ø –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ -->
                    <div class="plant-details-combined">
                        <div class="detail-combined">
                            <div class="detail-icon">üåø</div>
                            <div class="detail-text">{{ plant.plant_type }}</div>
                        </div>
                        <div class="detail-combined">
                            <div class="detail-icon">üìÖ</div>
                            <div class="detail-text">{{ plant.lifespan }}</div>
                        </div>
                    </div>
                    
                    <div class="plant-actions">
                        <button class="btn-care btn-outline view-details" data-id="{{ plant.id }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
            <div class="plant-card add-card hidden" id="add-plant-card">
                <div class="add-card-content">
                    <div class="add-icon">+</div>
                    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ç–µ–Ω–∏–µ</h3>
                </div>
            </div>
        </div>
    </div>
</div>



<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞—Å—Ç–µ–Ω–∏–π */
.plants-container {
    padding: 2rem 0;
    background: var(--background);
    min-height: 100vh;
}

.plants-header {
    background: var(--white);
    padding: 2rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
}

.header-content h1 {
    margin-bottom: 0.5rem;
    color: var(--primary-dark);
}

.filters {
    display: flex;
    gap: 1rem;
    flex-shrink: 0;
    flex-wrap: wrap;
    align-items: center;
}
.filter-label {
    font-weight: 600;
    color: #2d5a27;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}
.filter-select option:hover {
    background: #4caf50 !important;
    color: white !important;
}
.filter-select option:checked {
    background: #e8f5e8 !important;
    color: #2d5a27 !important;
    font-weight: 600;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –≤—ã–ø–∞–¥–∞—é—â–∏—Ö –º–µ–Ω—é */
.filter-select {
    padding: 0.75rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    background: white;
    font-size: 0.9rem;
    min-width: 160px;
    transition: all 0.3s ease;
    cursor: pointer;
    appearance: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8.5L1.5 4h9L6 8.5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 12px;
    padding-right: 2.5rem;
    position: relative;
    z-index: 1;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
.filter-select option {
    padding: 0.75rem 1rem;
    background: white;
    border: none;
    font-size: 0.9rem;
}
.filter-select:focus {
    border-color: #4caf50;
    outline: none;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234caf50' d='M6 8.5L1.5 4h9L6 8.5z'/%3E%3C/svg%3E");
}
.filter-select:hover {
    border-color: #bdbdbd;
}
.filter-select:active {
    border-color: #45a049;
}
.search-section {
    margin-bottom: 2rem;
}
.filter-select::-ms-expand {
    display: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –≤ IE */
}

.search-box {
    position: relative;
    max-width: 400px;
}

.search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-light);
}

.search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 3rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
}

.plants-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); /* –®–∏—Ä–æ–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    gap: 2.5rem;
}

.plant-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #f0f0f0;
    min-height: 520px; /* –í—ã—Å–æ–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    display: flex;
    flex-direction: column;
    width: 100%; /* –ó–∞–Ω–∏–º–∞—é—Ç –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é —à–∏—Ä–∏–Ω—É */
}

.plant-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
}
.plant-details-combined {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem; /* –ë–æ–ª—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è */
    margin-bottom: 2rem;
    flex-grow: 1;
}
.plant-image {
    height: 280px; /* –û—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–µ —Ñ–æ—Ç–æ */
    position: relative;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
}
.favorite-btn {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.3rem;
    color: #ccc;
    transition: all 0.3s ease;
}
.detail-combined {
    display: flex;
    align-items: center;
    gap: 1rem; /* –ë–æ–ª—å—à–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º */
    padding: 1rem; /* –ë–æ–ª—å—à–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ */
    background: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    min-height: 70px; /* –í—ã—Å–æ–∫–∏–µ –±–ª–æ–∫–∏ */
}

.detail-combined:hover {
    background: #e9ecef;
    transform: translateY(-2px);
}

.detail-icon {
    font-size: 1.5rem; /* –ö—Ä—É–ø–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ */
    width: 35px;
    text-align: center;
    flex-shrink: 0;
}
.detail-text {
    font-size: 1.1rem; /* –ö—Ä—É–ø–Ω—ã–π —Ç–µ–∫—Å—Ç */
    color: #495057;
    font-weight: 600;
    line-height: 1.3;
    text-align: center;
    flex-grow: 1;
    white-space: normal;
    overflow: visible;
    word-break: normal; /* –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã */
    hyphens: auto;
}
.plant-care-level {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    color: white;
}
.plant-info {
    padding: 2rem; /* –ë–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø–æ–≤ */
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 240px;
}
.plant-info h3 {
    font-size: 1.5rem; /* –ö—Ä—É–ø–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 0.5rem;
    line-height: 1.2;
}
.detail {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    color: #4a5568;
    font-size: 0.9rem;
}
.plant-actions {
    display: flex;
    gap: 1rem;
    margin-top: auto;
    flex-shrink: 0;
}
/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .plants-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .plant-card {
        min-height: 480px;
    }
    
    .plant-image {
        height: 250px;
    }
    .filters {
        width: 100%;
        justify-content: space-between;
    }
    
    .filter-select {
        flex: 1;
        min-width: 120px;
    }
}

@media (max-width: 480px) {
    .plant-details-combined {
        grid-template-columns: 1fr;
    }
    
    .detail-combined {
        min-height: 60px;
    }
    
    .detail-text {
        font-size: 1rem;
    }
    .filters {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .filter-select {
        width: 100%;
    }
}
.add-card {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 200px;
}

.add-card:hover {
    background: #e9ecef;
    border-color: #4caf50;
    transform: translateY(-2px);
}

.add-card-content {
    text-align: center;
    color: #6c757d;
}

.add-icon {
    font-size: 3rem;
    font-weight: 300;
    margin-bottom: 0.5rem;
    color: #6c757d;
}

.add-card:hover .add-icon {
    color: #4caf50;
}

.add-card h3 {
    font-size: 1.1rem;
    margin: 0;
    font-weight: 500;
}

/* –°–∫—Ä—ã–≤–∞–µ–º –¥–ª—è –Ω–µ-–∞–¥–º–∏–Ω–æ–≤ */
.add-card.hidden {
 
    display: none;
}
.plant-latin {
    font-style: italic;
    color: #666;
    font-size: 1rem; /* –ö—Ä—É–ø–Ω—ã–π —Ç–µ–∫—Å—Ç */
    margin-bottom: 1.5rem;
    line-height: 1.3;
}
.btn-care {
    flex: 1;
    padding: 1rem 1.5rem; /* –ë–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏ */
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-size: 1rem; /* –ö—Ä—É–ø–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ */
}

.btn-outline {
    background: transparent;
    border: 2px solid #4caf50;
    color: #4caf50;
}
.btn-outline:hover {
    background: #4caf50;
    color: white;
}
.btn-primary {
    background: linear-gradient(135deg, #4caf50, #45a049);
    color: white;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}
.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}
.btn-delete {
    background: #e74c3c;
    color: white;
    border: none;
    margin-left: 0.5rem;
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.btn-delete:hover {
    background: #c0392b;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
}
</style>
{% include "plant_modal.html" %}
<script>
// JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞—Å—Ç–µ–Ω–∏–π
document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const searchInput = document.getElementById('plantSearch');
    const plantsGrid = document.getElementById('plantsGrid');

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        const backgroundColor = type === 'success' ? 'var(--primary)' : '#f44336';
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${backgroundColor};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
            font-weight: 500;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    // –ö–Ω–æ–ø–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    const favoriteBtns = document.querySelectorAll('.favorite-btn');
    favoriteBtns.forEach(btn => {
        btn.addEventListener('click', async function() {
            const plantId = this.dataset.plantId;
            const plantName = this.closest('.plant-card').querySelector('h3').textContent;
            const isCurrentlyFavorite = this.classList.contains('active');
            
            try {
                if (isCurrentlyFavorite) {
                    // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                    const response = await fetch(`/api/remove-from-favorites/${plantId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        this.classList.remove('active');
                        showNotification(result.message, 'success');
                    } else {
                        showNotification(result.message, 'error');
                    }
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                    const response = await fetch(`api/add-to-favorites/${plantId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        this.classList.add('active');
                        showNotification(result.message, 'success');
                    } else {
                        showNotification(result.message, 'error');
                    }
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑', 'error');
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        });
    });

    // –ö–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
    const detailBtns = document.querySelectorAll('.view-details');
    detailBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const plantId = this.dataset.id;
            showPlantDetails(plantId);
        });
    });

    const typeFilter = document.getElementById('typeFilter');
    const careFilter = document.getElementById('careFilter');
    const lifespanFilter = document.getElementById('lifespanFilter');
    const lightFilter = document.getElementById('lightFilter');

    function filterPlants() {
        const searchTerm = searchInput.value.toLowerCase();
        const typeValue = typeFilter.value;
        const careValue = careFilter.value;
        const lifespanValue = lifespanFilter.value;
        
        const plantCards = plantsGrid.querySelectorAll('.plant-card:not(.add-card)');
        
        plantCards.forEach(card => {
            const plantName = card.dataset.name.toLowerCase();
            const plantLatin = card.dataset.latin.toLowerCase();
            const plantType = card.dataset.type;
            const plantCare = card.dataset.care;
            const plantLifespan = card.dataset.lifespan;
            
            const matchesSearch = plantName.includes(searchTerm) || plantLatin.includes(searchTerm);
            const matchesType = !typeValue || plantType === typeValue;
            const matchesCare = !careValue || plantCare === careValue;
            const matchesLifespan = !lifespanValue || plantLifespan === lifespanValue;
            
            if (matchesSearch && matchesType && matchesCare && matchesLifespan) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    typeFilter.addEventListener('change', filterPlants);
    careFilter.addEventListener('change', filterPlants);
    lifespanFilter.addEventListener('change', filterPlants);
    searchInput.addEventListener('input', filterPlants);

        // –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π —Ä–∞—Å—Ç–µ–Ω–∏—è

    async function setupAddPlantButton() {
        try {
            const response = await fetch('/api/is_admin');
            const userData = await response.json();

            if (userData.is_admin) {
                const addButton = document.getElementById('add-plant-card');
                addButton.classList.remove('hidden');
                addButton.onclick = function(){
                    window.location.href = '/add-plant';
                }
            }
        } catch(error) {
            console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞:', error);
        }
    }
    async function setupDeletePlantButtons() {
        try {
            const response = await fetch('/api/is_admin');
            const userData = await response.json();

            if (!userData.is_admin) return;

            document.querySelectorAll('.view-details').forEach(btn => {
                const plantId = btn.dataset.id;
                const plantName = btn.closest('.plant-card')?.dataset.name || '–†–∞—Å—Ç–µ–Ω–∏–µ';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-care btn-delete';
                deleteBtn.dataset.plantId = plantId;
                deleteBtn.dataset.plantName = plantName;
                deleteBtn.innerHTML = 'üóë –£–¥–∞–ª–∏—Ç—å';
                btn.parentNode.appendChild(deleteBtn);

                deleteBtn.addEventListener('click', async function (e) {
                    e.preventDefault();
                    if (!confirm(`–£–¥–∞–ª–∏—Ç—å "${plantName}"?`)) return;

                    try {
                        const res = await fetch(`/api/delete-plant/${plantId}`, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const result = await res.json();
                        if (res.ok) {
                            alert(result.message);
                            btn.closest('.plant-card').remove();
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + result.message);
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                    }
                });
            });
        } catch (error) {
            console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞:', error);
        }
    }
    setupAddPlantButton();
    setupDeletePlantButtons();
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å ?search=)
    function autoSearchFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const searchParam = urlParams.get('search');
        if (searchParam) {
            searchInput.value = decodeURIComponent(searchParam);
            filterPlants(); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
            // –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            plantsGrid.scrollIntoView({ behavior: 'smooth' });
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    autoSearchFromURL();

});
</script>


{% endblock %}
